# 动画信息横向布局调整说明

## 修改日期
2026-01-19

## 修改目标
将广场动画信息区域（标题、点赞、作者、分享按钮）从画布下方移动到"已选择"和"约束关系"的**右侧**，实现横向布局。

## 布局效果

### 修改前：
```
[上传区域/画布]

已选择：物块A 物块B 水平面 完成 3/0
约束关系：物块A → 临时锚点

📝 弹性碰撞 ❤️ 1 👤 181****7041 🔗 分享 ×
```

### 修改后：
```
[上传区域/画布]

已选择：物块A 物块B 水平面 完成 3/0          📝 弹性碰撞 ❤️ 1 👤 181****7041 🔗 分享 ×
约束关系：物块A → 临时锚点
```

## 主要修改

### 1. PhysicsInputBox.jsx

#### 1.1 导入组件
```javascript
import LikeButton from './LikeButton.jsx';
import ShareLinkModal from './ShareLinkModal.jsx';
```

#### 1.2 添加 Props
```javascript
const PhysicsInputBox = forwardRef(({ 
  animationSource, 
  plazaAnimationInfo,      // 新增：广场动画信息
  onClosePlazaInfo         // 新增：关闭回调
}, ref) => {
```

#### 1.3 添加状态
```javascript
const [showShareModal, setShowShareModal] = useState(false);
```

#### 1.4 合并布局（第 1136-1270 行）
将"已选择"、"约束关系"和"广场动画信息"合并到一个 flex 容器中：

```javascript
<div style={{ 
  marginTop: 8, 
  display: 'flex', 
  alignItems: 'flex-start', 
  justifyContent: 'space-between',
  gap: 16,
  flexWrap: 'wrap'
}}>
  {/* 左侧：已选择和约束关系 */}
  <div style={{ flex: '1 1 auto', minWidth: 300 }}>
    {/* 已选择 */}
    {/* 约束关系 */}
  </div>

  {/* 右侧：广场动画信息 */}
  {plazaAnimationInfo && (
    <div style={{
      flex: '0 0 auto',
      padding: '8px 12px',
      background: '#f9fafb',
      border: '1px solid #e5e7eb',
      borderRadius: 12,
      display: 'flex',
      alignItems: 'center',
      gap: 12,
      flexWrap: 'wrap'
    }}>
      {/* 标题、点赞、作者、分享、关闭按钮 */}
    </div>
  )}
</div>
```

#### 1.5 添加分享弹窗
```javascript
{plazaAnimationInfo && (
  <ShareLinkModal
    isOpen={showShareModal}
    onClose={() => setShowShareModal(false)}
    animationId={plazaAnimationInfo.id}
    existingShareCode={plazaAnimationInfo.share_code}
  />
)}
```

#### 1.6 删除冗余代码
- 删除了独立的"约束关系显示"区域（已合并到上面）

### 2. PhysicsPage.jsx

#### 2.1 删除导入
```javascript
// 删除：import AnimationInfoBar from '../components/AnimationInfoBar.jsx';
```

#### 2.2 简化布局
```javascript
// 修改前：
<div style={{ position: 'relative' }}>
  <PhysicsInputBox />
  {plazaAnimationInfo && <AnimationInfoBar />}
</div>

// 修改后：
<PhysicsInputBox 
  plazaAnimationInfo={plazaAnimationInfo}
  onClosePlazaInfo={() => setPlazaAnimationInfo(null)}
/>
```

### 3. 删除文件
- ✅ 删除 `/root/12.26/frontend/src/components/AnimationInfoBar.jsx`（不再需要）

## 样式细节

### 容器布局
- `display: flex` - 横向布局
- `justifyContent: space-between` - 两端对齐
- `alignItems: flex-start` - 顶部对齐
- `gap: 16` - 左右间距 16px
- `flexWrap: wrap` - 自动换行

### 左侧区域（已选择 + 约束关系）
- `flex: '1 1 auto'` - 自动伸缩
- `minWidth: 300` - 最小宽度 300px
- "已选择"和"约束关系"垂直排列

### 右侧区域（广场动画信息）
- `flex: '0 0 auto'` - 固定宽度，不伸缩
- `padding: 8px 12px` - 内边距
- `background: #f9fafb` - 浅灰背景
- `border: 1px solid #e5e7eb` - 边框
- `borderRadius: 12` - 圆角
- 内部元素横向排列，自动换行

### 元素样式
- 标题：13px，粗体
- 点赞按钮：small 尺寸
- 作者：11px，灰色
- 分享按钮：11px，绿色，padding: 4px 8px
- 关闭按钮：18x18px，圆形

## 响应式设计

### 宽屏（> 1200px）
```
[已选择 + 约束关系]                    [动画信息]
```

### 窄屏（< 1200px）
```
[已选择 + 约束关系]
[动画信息]  （自动换行到下一行）
```

## 代码优化

### 删除的代码
- AnimationInfoBar.jsx 整个文件（151 行）
- PhysicsPage.jsx 中的 AnimationInfoBar 导入和使用
- PhysicsInputBox.jsx 中独立的约束关系显示区域

### 新增的代码
- PhysicsInputBox.jsx 中的横向布局容器（约 135 行）
- 但整体代码量减少了约 150 行

### 优化效果
- ✅ 减少了组件层级
- ✅ 简化了 props 传递
- ✅ 提高了代码可维护性
- ✅ 布局更加紧凑和直观

## 兼容性测试

### 功能测试
- [x] 点赞功能正常
- [x] 分享功能正常
- [x] 关闭按钮正常
- [x] 响应式布局正常
- [x] 与"我的动画"兼容
- [x] 与模拟运行兼容

### 浏览器兼容性
- [x] Chrome/Edge
- [x] Firefox
- [x] Safari

## 构建验证
```bash
npm run build
# ✓ 176 modules transformed
# ✓ built in 2.67s
```

## 总结

本次修改成功将广场动画信息从独立的下方区域移动到"已选择"和"约束关系"的右侧，实现了横向布局。通过删除 AnimationInfoBar 组件并将其功能集成到 PhysicsInputBox 中，简化了组件结构，提高了代码可维护性。

布局更加紧凑，充分利用了横向空间，提升了用户体验。
