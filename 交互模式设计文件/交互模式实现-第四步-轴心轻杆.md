# ç¬¬å››æ­¥ï¼šè½´å¿ƒç‚¹ä¸è½»æ†ç³»ç»Ÿå®ç°

## ç›®æ ‡

å®ç°è½»æ†å¯ä»¥ç»•è½´å¿ƒç‚¹æ—‹è½¬ï¼Œæ‹–æ‹½æ†ç«¯ç‰©ä½“æ—¶æ•´ä¸ªæ†æ—‹è½¬ï¼Œæ¾æ‰‹åç‰©ä½“æ‘†åŠ¨æˆ–åšåœ†å‘¨è¿åŠ¨ã€‚

---

## ä»£ç é‡ä¼°ç®—

- `physicsEngine.js` ä¿®æ”¹ï¼šçº¦ 100 è¡Œ
- **æ€»è®¡ï¼šçº¦ 100 è¡Œ**

---

## æ ¸å¿ƒç®—æ³•

**æ¥æº**ï¼š`è½´å¿ƒç‚¹å®ç°ç®—æ³•.html` + Matter.js Constraint

### å®ç°æ–¹å¼

ä½¿ç”¨ Matter.js çš„ **åˆšæ€§çº¦æŸ**ï¼ˆConstraintï¼‰è¿æ¥è½´å¿ƒç‚¹å’Œæ†ç«¯ç‰©ä½“ï¼š

```javascript
// åˆ›å»ºè½´å¿ƒç‚¹ï¼ˆé™æ€ï¼‰
const pivotBody = Bodies.circle(pivotX, pivotY, 12, { 
  isStatic: true  // å›ºå®šä¸åŠ¨
});

// åˆ›å»ºè½»æ†çº¦æŸ
const rodConstraint = Matter.Constraint.create({
  bodyA: pivotBody,      // è½´å¿ƒç‚¹
  bodyB: connectedBody,  // æ†ç«¯ç‰©ä½“
  pointA: { x: 0, y: 0 },
  pointB: { x: 0, y: 0 },
  length: rodLength,      // æ†é•¿ï¼ˆå›ºå®šï¼‰
  stiffness: 1.0,         // å®Œå…¨åˆšæ€§
  damping: 0.01           // å¾®å°é˜»å°¼
});
```

**å…³é”®å‚æ•°**ï¼š
- `stiffness: 1.0`ï¼šæ†å®Œå…¨åˆšæ€§ï¼Œé•¿åº¦ä¸å˜
- è½´å¿ƒç‚¹ `isStatic: true`ï¼šä½ç½®å›ºå®š
- æ†ç«¯ç‰©ä½“ `isStatic: false`ï¼šå¯ä»¥ç§»åŠ¨

---

## ç”¨æˆ·äº¤äº’æµç¨‹

### åœºæ™¯ï¼šå¤§æ¨¡å‹è¯†åˆ«åˆ°è½´å¿ƒç‚¹+è½»æ†

1. **åç«¯è¿”å›**ï¼š
```json
{
  "constraintType": "pivot_rod",
  "pivotName": "è½´å¿ƒç‚¹",
  "bodyName": "æ‘†çƒ",
  "length": 150
}
```

2. **ç”¨æˆ·æ“ä½œ**ï¼š
   - ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«è½´å¿ƒç‚¹å’Œæ†ç«¯ç‰©ä½“
   - ç”¨æˆ·åªéœ€æ¡†é€‰å¯¹åº”å…ƒç´ ç¡®è®¤
   - ç‚¹å‡»"åˆ›å»ºæ¨¡æ‹Ÿ"

---

## å®Œæˆåçš„å‰ç«¯æ•ˆæœ

### é˜¶æ®µä¸€ï¼šåˆ›å»ºæ¨¡æ‹Ÿåçš„åˆå§‹çŠ¶æ€

**ä½ èƒ½çœ‹åˆ°**ï¼š

1. **è½´å¿ƒç‚¹æ˜¾ç¤º**ï¼š
   - æ©™è‰²åœ†ç‚¹ï¼ˆç›´å¾„çº¦ 24pxï¼‰
   - ä¸­å¿ƒæœ‰ç™½è‰²å°åœ†ç‚¹
   - ä½ç½®å›ºå®šä¸åŠ¨
   - æ ‡ç­¾ï¼š"è½´å¿ƒç‚¹"

2. **è½»æ†æ˜¾ç¤º**ï¼š
   - **ä¼˜å…ˆæ˜¾ç¤ºç²¾çµå›¾**ï¼ˆå¦‚æœåç«¯è¿”å›äº†è½»æ†ç²¾çµå›¾ï¼‰
   - ç²¾çµå›¾ä¼šéšç€è½»æ†æ—‹è½¬
   - å¦‚æœæ²¡æœ‰ç²¾çµå›¾ï¼Œæ˜¾ç¤º**ç»†ç°çº¿**ï¼ˆ2pxï¼Œ#666666ï¼‰
   - æ†ä¿æŒç¬”ç›´ï¼ˆä¸ä¼šå¼¯æ›²ï¼‰

3. **æ†ç«¯ç‰©ä½“**ï¼š
   - æ˜¾ç¤ºç‰©ä½“çš„ç²¾çµå›¾ï¼ˆå¦‚æ‘†çƒï¼‰
   - å¯ä»¥ç§»åŠ¨å’Œæ—‹è½¬

---

### é˜¶æ®µäºŒï¼šæ‹–æ‹½æ†ç«¯ç‰©ä½“

**æµ‹è¯•ï¼šæ‹–åŠ¨æ‘†çƒ**

4. **æ‹–æ‹½æ—¶çš„æ•ˆæœ**ï¼š
   - ç‚¹å‡»å¹¶æ‹–åŠ¨æ‘†çƒ
   - æ‘†çƒè¢«çº¦æŸåœ¨ä»¥è½´å¿ƒä¸ºåœ†å¿ƒçš„åœ†å‘¨ä¸Š
   - å¯ä»¥æ‹–åˆ°ä»»æ„è§’åº¦ï¼ˆ0Â° - 360Â°ï¼‰
   - è½»æ†ï¼ˆç°çº¿ï¼‰ç»•è½´å¿ƒç‚¹æ—‹è½¬
   - æ†é•¿å§‹ç»ˆä¸å˜

5. **è§†è§‰æ•ˆæœ**ï¼š
   - è½´å¿ƒç‚¹ï¼šå›ºå®šä¸åŠ¨ï¼ˆæ©™è‰²åœ†ç‚¹ï¼‰
   - è½»æ†ï¼šè·Ÿéšæ—‹è½¬ï¼ˆç°çº¿æˆ–ç²¾çµå›¾ï¼‰
   - æ‘†çƒï¼šè·Ÿéšé¼ æ ‡åœ¨åœ†å‘¨ä¸Šç§»åŠ¨

---

### é˜¶æ®µä¸‰ï¼šæ¾æ‰‹åçš„è¿åŠ¨

**åœºæ™¯Aï¼šå°è§’åº¦é‡Šæ”¾ï¼ˆå•æ‘†æ•ˆæœï¼‰**

6. **ä½ èƒ½çœ‹åˆ°**ï¼š
   - æ‘†çƒåœ¨é‡åŠ›ä½œç”¨ä¸‹æ‘†åŠ¨
   - è½»æ†è·Ÿéšæ‘†çƒæ—‹è½¬
   - æ‘†åŠ¨å¹…åº¦é€æ¸å‡å°
   - çº¦ 5 ç§’ååœæ­¢ï¼ˆé˜»å°¼æ•ˆæœï¼‰
   - æœ€ç»ˆé™æ­¢åœ¨æœ€ä½ç‚¹ï¼ˆå‚ç›´å‘ä¸‹ï¼‰

**åœºæ™¯Bï¼šå¤§è§’åº¦æˆ–é«˜é€Ÿé‡Šæ”¾ï¼ˆåœ†å‘¨è¿åŠ¨ï¼‰**

7. **ä½ èƒ½çœ‹åˆ°**ï¼š
   - æ‘†çƒåšå®Œæ•´çš„ 360Â° åœ†å‘¨è¿åŠ¨
   - è½»æ†è¿ç»­æ—‹è½¬
   - é€Ÿåº¦é€æ¸å‡æ…¢
   - æœ€ç»ˆå˜ä¸ºå•æ‘†æ‘†åŠ¨

---

### é˜¶æ®µå››ï¼šä¸ç»³å­å•æ‘†çš„å¯¹æ¯”

| ç‰¹æ€§ | ç»³å­å•æ‘† | è½»æ†å•æ‘† |
|------|---------|---------|
| **è¿æ¥æ–¹å¼** | é»‘è‰²æŸ”æ€§ç»³ï¼ˆ4pxï¼‰ | ç°è‰²åˆšæ€§æ†ï¼ˆ2pxï¼‰ |
| **å½¢æ€** | ä¼šå¼¯æ›²ã€ä¸‹å‚ | å§‹ç»ˆç¬”ç›´ |
| **è¿åŠ¨èŒƒå›´** | åªèƒ½åœ¨ä¸‹æ–¹æ‘†åŠ¨ | å¯ä»¥è½¬åˆ°ä¸Šæ–¹ï¼ˆ360Â°ï¼‰ |
| **é‡Šæ”¾å** | ç»³å­æ™ƒåŠ¨ | æ†ä¸å¼¯æ›² |
| **åœ†å‘¨è¿åŠ¨** | âŒ ä¸å¯èƒ½ | âœ… å¯ä»¥ |

---

## æµ‹è¯•åœºæ™¯

### æµ‹è¯• 1ï¼šå•æ‘†æ‘†åŠ¨

1. æ‹–åŠ¨æ‘†çƒåˆ°æ°´å¹³ä½ç½®ï¼ˆ90Â°ï¼‰
2. æ¾æ‰‹
3. âœ… ç¡®è®¤ï¼šæ‘†çƒæ‘†åŠ¨ï¼Œæ†æ—‹è½¬
4. âœ… ç¡®è®¤ï¼šæ‘†åŠ¨é€æ¸å‡å°ï¼Œåœåœ¨åº•éƒ¨

### æµ‹è¯• 2ï¼šåœ†å‘¨è¿åŠ¨

1. å¿«é€Ÿç”©åŠ¨æ‘†çƒåˆ°é¡¶éƒ¨
2. æ¾æ‰‹
3. âœ… ç¡®è®¤ï¼šæ‘†çƒåšå®Œæ•´åœ†å‘¨è¿åŠ¨
4. âœ… ç¡®è®¤ï¼šæ†è¿ç»­æ—‹è½¬
5. âœ… ç¡®è®¤ï¼šé€Ÿåº¦é€æ¸å‡æ…¢

### æµ‹è¯• 3ï¼šæ†é•¿ä¸å˜

1. æ‹–åŠ¨æ‘†çƒåˆ°å„ä¸ªä½ç½®
2. âœ… ç¡®è®¤ï¼šè½´å¿ƒç‚¹åˆ°æ‘†çƒçš„è·ç¦»å§‹ç»ˆç›¸åŒ
3. âœ… ç¡®è®¤ï¼šæ†ä¸ä¼šæ‹‰ä¼¸æˆ–å‹ç¼©

---

## æ ¸å¿ƒä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰

```javascript
// åœ¨ physicsEngine.js ä¸­
constraints.forEach(c => {
  if (c.constraintType === 'pivot_rod') {
    const pivotBody = bodiesMap[c.pivotName];
    const connectedBody = bodiesMap[c.bodyName];
    
    // ç¡®ä¿è½´å¿ƒç‚¹é™æ€
    Body.setStatic(pivotBody, true);
    
    // åˆ›å»ºåˆšæ€§çº¦æŸ
    const rodConstraint = Constraint.create({
      bodyA: pivotBody,
      bodyB: connectedBody,
      length: c.length || calculateDistance(pivotBody, connectedBody),
      stiffness: 1.0,  // åˆšæ€§
      damping: 0.01    // å¾®å°é˜»å°¼
    });
    
    Composite.add(engine.world, rodConstraint);
    
    // ä¿å­˜ç”¨äºç»˜åˆ¶
    rodConstraints.push({ pivotBody, connectedBody, length });
  }
});

// ç»˜åˆ¶è½»æ†
Events.on(render, 'afterRender', () => {
  const ctx = render.canvas.getContext('2d');
  
  rodConstraints.forEach(rod => {
    const pivotPos = rod.pivotBody.position;
    const bodyPos = rod.connectedBody.position;
    
    // ğŸ”‘ å¦‚æœæœ‰ç²¾çµå›¾ï¼Œç»˜åˆ¶ç²¾çµå›¾
    if (rod.sprite && rod.sprite.url) {
      const angle = Math.atan2(bodyPos.y - pivotPos.y, bodyPos.x - pivotPos.x);
      const length = rod.length;
      
      ctx.save();
      ctx.translate(pivotPos.x, pivotPos.y);
      ctx.rotate(angle);
      
      // ç»˜åˆ¶ç²¾çµå›¾ï¼ˆæ‹‰ä¼¸åˆ°æ†é•¿ï¼‰
      const img = new Image();
      img.src = rod.sprite.url;
      ctx.drawImage(img, 0, -rod.sprite.height / 2, length, rod.sprite.height);
      
      ctx.restore();
    } else {
      // ğŸ”‘ æ²¡æœ‰ç²¾çµå›¾æ—¶ï¼Œç»˜åˆ¶ç®€å•çš„ç°è‰²çº¿
      ctx.beginPath();
      ctx.moveTo(pivotPos.x, pivotPos.y);
      ctx.lineTo(bodyPos.x, bodyPos.y);
      ctx.strokeStyle = '#666666';
      ctx.lineWidth = 2;
      ctx.stroke();
    }
  });
});
```

---

## å¸¸è§é—®é¢˜

**Qï¼šè½´å¿ƒç‚¹è¢«æ‹–åŠ¨äº†ï¼Ÿ**  
Aï¼šç¡®ä¿ `Body.setStatic(pivotBody, true)`

**Qï¼šæ†ä¼šæ‹‰ä¼¸ï¼Ÿ**  
Aï¼šç¡®ä¿ `stiffness: 1.0`

**Qï¼šæ‘†çƒæ°¸ä¹…è¿åŠ¨ä¸åœï¼Ÿ**  
Aï¼šå¢åŠ  `damping: 0.01` æˆ–æ›´å¤§

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**é¢„è®¡å¼€å‘æ—¶é—´**ï¼š1 å¤©

